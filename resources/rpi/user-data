ntp:
  enabled: true
  servers:
    - <SSO NTP server>
    - time1.google.com
    - time2.google.com
    - time3.google.com
    - time4.google.com

#cloud-config
# https://cloudinit.readthedocs.io/

# Set the first part of the name to camera device, e.g. huntsmanpi000
hostname: <hostname>

# If you have set up ssh on github you can pull down your
# key automatically so that you can log into the unit without
# a password. Change 'CHANGEME' to your username below.
ssh_import_id:
  - gh:huntsmanscope

# Setting "expire: true" will force a password change on first login.
chpasswd:
  expire: true
  list:
    # user:password
    - huntsman:huntsman

ssh_pwauth: true

groups:
  - huntsman
  - panoptes
  - docker

users:
  - name: huntsman
    gecos: Huntsman Camera <camera name>
    primary_group: huntsman
    groups: users, admin, dialout, plugdev, docker, i2c, input, gpio, panoptes
    sudo: ALL=(ALL) NOPASSWD:ALL
    lock_passwd: false
    shell: /bin/zsh
    ssh_authorized_keys:
      - <camera_rsa.pub contents>

## Update apt database and upgrade packages on first boot
package_update: true
package_upgrade: true

byobu: enable

ssh_deletekeys: true  # remove existing
ssh_keys:
  rsa_private: |
    -----BEGIN RSA PRIVATE KEY-----
    <camera_rsa contents>
    -----END RSA PRIVATE KEY-----
  rsa_public: <camera_rsa.pub contents>
ssh_authorized_keys:
  - <camera_rsa.pub contents>

## Install additional packages on first boot.
packages:
  - htop
  - zsh
  - speedometer
  - ack
  - vim-nox

write_files:
  # Allow huntsman user to mount via sshfs.
  - content: |
      user_allow_other
    path: /etc/fuse.conf
    append: true
  # Default zshrc file.
  - content: |
    # If you come from bash you might have to change your $PATH.
    export PATH=$HOME/bin:/usr/local/bin:$PATH

    # Path to your oh-my-zsh installation.
    export ZSH="/home/huntsman/.oh-my-zsh"

    ZSH_THEME="agnoster"

    DISABLE_AUTO_UPDATE="true"
    DISABLE_UPDATE_PROMPT="true"
    export UPDATE_ZSH_DAYS=60

    plugins=(git sudo bgnotify zsh-autosuggestions dotenv)

    source $ZSH/oh-my-zsh.sh

    # You may need to manually set your language environment
    export LANG=en_US.UTF-8

    # byobu panes have separate history.
    unsetopt share_history

  path: /home/huntsman/.zshrc
  append: true

## Get and run the install script upon first boot.
runcmd:
  # Oh my zsh on the Pi host. Because it's better. TODO add a default zshrc file.
  - [ sh, -c, $(wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O-) ]
  - [ curl, -fsSL, get.docker.com, -o, get-docker.sh ]
  - [ sh, get-docker.sh ]
  - [ pip, install, docker-compose ]
  - [ docker, pull, huntsmanarray/camera:tenlens ]


power_state:
  delay: '+2'
  timeout: 30
  mode: reboot
  message: It's alive!!!

final_message: Welcome to Huntsman POCS!
